{{/*
Deterministically sort a Pages collection by frontmatter param `collection_order`.

Why this exists:
- `.Pages.ByParam "collection_order"` can behave inconsistently when the param type
  differs (number vs string) or parsing differs between environments.
- We force-cast to int and add a permalink tie-breaker for a stable order.

Usage:
  {{- $sorted := partial "helper/sort-by-collection-order" .Pages -}}
  {{- range $sorted }} ... {{ end }}
*/}}

{{- $pages := . -}}
{{- $items := slice -}}

{{- range $p := $pages -}}
  {{- $order := 999999 -}}
  {{- if isset $p.Params "collection_order" -}}
    {{- /* `int` handles numeric and numeric-strings; `0` must not be treated as empty */ -}}
    {{- $order = int (index $p.Params "collection_order") -}}
  {{- end -}}
  {{- $key := printf "%010d|%s" $order $p.RelPermalink -}}
  {{- $items = $items | append (dict "key" $key "page" $p) -}}
{{- end -}}

{{- $sortedItems := sort $items "key" "asc" -}}
{{- $sortedPages := slice -}}
{{- range $it := $sortedItems -}}
  {{- $sortedPages = $sortedPages | append (index $it "page") -}}
{{- end -}}

{{- return $sortedPages -}}

