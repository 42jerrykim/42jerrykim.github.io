{{ define "body-class" }}template-search{{ end }}
{{ define "head" }}
    <!-- Pagefind 리소스 -->
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>
    
    <!-- 성능 최적화를 위한 리소스 힌트 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="preconnect" href="/pagefind/" crossorigin>
    
    <!-- 이미지 최적화를 위한 메타 태그 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- 검색 결과 이미지 스타일 -->
    <style>
        /* Skeleton 로딩 애니메이션 */
        @keyframes skeleton-loading {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        /* 검색 결과 이미지 컨테이너 스타일 */
        .search-result-image {
            border: 1px solid #e0e0e0;
            background-color: #f8f9fa;
        }
        
        /* 통합된 다크모드 지원 */
        @media (prefers-color-scheme: dark) {
            .search-result-image {
                border-color: #404040;
                background-color: #2a2a2a;
                background: linear-gradient(90deg, #404040 25%, transparent 37%, #404040 63%);
                background-size: 400% 100%;
            }
        }
        
        [data-scheme="dark"] .search-result-image {
            border-color: #404040;
            background-color: #2a2a2a;
            background: linear-gradient(90deg, #404040 25%, transparent 37%, #404040 63%);
            background-size: 400% 100%;
        }
    </style>
{{ end }}
{{ define "main" }}
<form class="search-form" onsubmit="return false;">
    <p>
        <label>{{ T "search.title" }}</label>
        <input id="pagefind-search-input" name="keyword" placeholder="{{ T `search.placeholder` }}" />
    </p>

    <button type="button" title="{{ T `search.title` }}" onclick="triggerSearch()">
        {{ partial "helper/icon" "search" }}
    </button>
</form>

<div class="search-result">
    <h3 class="search-result--title section-title"></h3>
    <div class="search-result--list article-list--compact">
        <div id="search"></div>
    </div>
</div>

<script>
/**
 * Pagefind 검색 페이지 - 이미지 최적화 및 사용자 경험 개선
 * 
 * 주요 기능:
 * - Pagefind meta image 우선 사용
 * - 스마트 이미지 후보 검색
 * - 캐시 기반 성능 최적화
 * - 다양한 fallback 이미지 지원
 */

// ========================================
// 전역 변수 및 초기화
// ========================================

let pagefindInstance;

// 전역 캐시 변수들은 ImageCacheManager로 통합됨

// 간소화된 이미지 URL 저장소
const imageUrlStore = new Map();

// ========================================
// 이미지 로딩 관련 유틸리티
// ========================================

/**
 * 이미지 캐시 관리 시스템
 */
const ImageCacheManager = {
    // 내장 캐시 시스템
    cache: new Map(),
    failedUrls: new Set(),
    
    /**
     * 캐시에서 이미지 URL 가져오기
     * @param {string} url - 페이지 URL
     * @returns {string|undefined} - 캐시된 이미지 URL 또는 undefined
     */
    get(url) {
        return this.cache.get(url);
    },

    /**
     * 이미지 URL을 캐시에 저장
     * @param {string} url - 페이지 URL
     * @param {string} imageUrl - 이미지 URL
     */
    set(url, imageUrl) {
        this.cache.set(url, imageUrl);
    },

    /**
     * 실패한 URL 확인
     * @param {string} url - 확인할 URL
     * @returns {boolean} - 실패한 URL인지 여부
     */
    isFailed(url) {
        return this.failedUrls.has(url);
    },

    /**
     * 실패한 URL 추가
     * @param {string} url - 실패한 URL
     */
    addFailed(url) {
        this.failedUrls.add(url);
    }
};

/**
 * 이미지 엘리먼트 생성 - 검색 결과에 이미지 추가
 * @param {HTMLElement} result - 검색 결과 엘리먼트
 * @param {HTMLElement} link - 링크 엘리먼트 
 * @param {string} imageUrl - 이미지 URL
 */
function createImageElement(result, link, imageUrl) {
        const imageContainer = document.createElement('div');
        imageContainer.className = 'search-result-image';
        
        // 레이아웃 시프트 방지를 위한 고정 크기 설정 (CSS와 일치)
        const isMobile = window.innerWidth <= 768;
        
        imageContainer.style.cssText = `
            width: ${isMobile ? '100%' : '120px'};
            height: ${isMobile ? '200px' : '120px'};
            flex-shrink: 0;
            position: relative;
            background: linear-gradient(90deg, #f0f0f0 25%, transparent 37%, #f0f0f0 63%);
            background-size: 400% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 1.5rem;
            margin-left: ${isMobile ? '0' : '2.5rem'};
            margin-right: 0;
            margin-bottom: ${isMobile ? '1rem' : '0'};
            border: 1px solid #e0e0e0;
            background-color: #f8f9fa;
        `;

        const img = document.createElement('img');
        img.alt = link.textContent;
        img.loading = 'lazy';
        
        // 이미지 스타일 설정
        img.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        `;
        
        // 즉시 이미지 로딩 시작 (뷰포트 진입을 기다리지 않음)
        img.src = imageUrl;
        
        // skeleton 제거를 위한 헬퍼 함수
        function removeSkeleton() {
            imageContainer.style.background = 'var(--card-background, #ffffff)';
            imageContainer.style.animation = 'none';
            imageContainer.style.border = '1px solid var(--card-separator-color, #ddd)';
            img.style.opacity = '1';
        }
        
        // 이미지 로딩 성공 시 캐시에 저장
        img.onload = function() {
            console.log('✅ 이미지 로딩 완료:', img.src);
            const pageUrl = link.href;
            if (pageUrl) {
                ImageCacheManager.set(pageUrl, img.src);
            }
            
            // skeleton 애니메이션 제거 및 이미지 표시
            removeSkeleton();
        };
        
        // 이미지 로드 실패 시 처리 - 레이아웃 시프트 방지
        img.onerror = function() {
            console.log('❌ 이미지 로드 실패:', imageUrl);
            
            // 이미지 로드 실패 시에도 컨테이너 유지 (레이아웃 시프트 방지)
            console.log('💥 이미지 로드 실패, 컨테이너 유지');
            
            // skeleton 애니메이션을 정적 배경으로 변경 (다크 모드 지원)
            const isDarkMode = document.documentElement.getAttribute('data-scheme') === 'dark' || 
                              document.documentElement.classList.contains('dark') || 
                              document.body.classList.contains('dark') ||
                              window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (isDarkMode) {
                imageContainer.style.background = '#2a2a2a';
                imageContainer.style.border = '1px solid #444';
            } else {
                imageContainer.style.background = '#f8f9fa';
                imageContainer.style.border = '1px solid #e0e0e0';
            }
            imageContainer.style.animation = 'none';
            
            // 실패 표시를 위한 아이콘 또는 텍스트 추가
            const textColor = isDarkMode ? '#a0a0a0' : '#6c757d';
            imageContainer.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: ${textColor}; font-size: 12px;">이미지 없음</div>`;
        };

        // 기존 이미지 컨테이너가 있으면 그것을 사용
        let existingContainer = result.querySelector('.search-result-image');
        console.log('🔍 기존 컨테이너 검색:', {
            url: imageUrl,
            resultElement: result,
            existingContainer: !!existingContainer,
            resultHTML: result.outerHTML.substring(0, 200) + '...'
        });
        
        if (existingContainer) {
            // 기존 컨테이너에 이미지 추가
            existingContainer.appendChild(img);
            // skeleton 스타일 제거
            existingContainer.style.background = 'var(--card-background, #ffffff)';
            existingContainer.style.animation = 'none';
            existingContainer.style.border = '1px solid var(--card-separator-color, #ddd)';
            console.log('🔄 기존 컨테이너에 이미지 추가:', imageUrl);
        } else {
            // 새로 컨테이너 생성 (fallback)
            imageContainer.appendChild(img);

            // 검색 결과 구조 변경
            const resultContent = document.createElement('div');
            resultContent.className = 'search-result-content';

            // 기존 내용을 새 컨테이너로 이동
            while (result.firstChild) {
                resultContent.appendChild(result.firstChild);
            }

            // 이미지와 내용을 결과에 추가
            result.appendChild(imageContainer);
            result.appendChild(resultContent);
            console.log('🆕 새 컨테이너에 이미지 추가:', imageUrl);
        }
    }
    
// createPlaceholderElement 함수 제거됨 - 즉시 skeleton 컨테이너 생성 방식으로 대체
    
    window.addEventListener('DOMContentLoaded', (event) => {
        // PagefindUI 초기화 시 검색 입력 숨기기
        pagefindInstance = new PagefindUI({ 
            element: "#search", 
            showSubResults: true,
            showEmptyFilters: true,
            resetStyles: false,
            autofocus: false,
            processResult: function(result) {
                // 간소화된 제목 처리 - meta.title만 사용
                if (result.meta && result.meta.title) {
                    result.meta.title = result.meta.title.trim();
                }
                // URL에서 제목 추출 로직 제거됨 - meta.title이 대부분 존재함
                
                // 작성자 정보가 "42jerrykim"으로 잘못 설정된 경우 제거
                if (result.meta && result.meta.author === "42jerrykim") {
                    delete result.meta.author;
                }
                
                // 이미지 처리 로직 추가 - pagefind meta image 사용
                let imageUrl = null;
                if (result.meta && result.meta.image) {
                    imageUrl = result.meta.image.trim();
                    console.log('📋 Pagefind Meta 이미지 발견:', imageUrl, 'for', result.url);
                    
                    // 상대 경로인 경우 절대 경로로 변환
                    if (imageUrl.startsWith('/')) {
                        imageUrl = window.location.origin + imageUrl;
                    } else if (!imageUrl.startsWith('http')) {
                        // assets/images로 시작하는 경우 등
                        imageUrl = window.location.origin + '/' + imageUrl;
                    }
                    
                    console.log('✅ Pagefind Meta 이미지 처리됨:', imageUrl);
                } else {
                    console.log('❌ Pagefind Meta 이미지 없음 for:', result.url);
                }
                
                // 이미지 URL 저장 (아바타가 아닌 경우만)
                if (imageUrl && !imageUrl.includes('avatar')) {
                    imageUrlStore.set(result.url, imageUrl);
                    console.log('💾 이미지 URL 저장:', result.url, '→', imageUrl);
                } else if (imageUrl && imageUrl.includes('avatar')) {
                    console.log('🚫 아바타 이미지 제외:', imageUrl);
                }
                
                return result;
            },
            translations: {
                placeholder: "검색어를 입력하세요...",
                clear_search: "검색 지우기",
                load_more: "더 보기",
                search_label: "사이트 검색",
                filters_label: "필터",
                zero_results: "검색 결과가 없습니다: [SEARCH_TERM]",
                many_results: "[COUNT]개의 결과가 있습니다: [SEARCH_TERM]",
                one_result: "1개의 결과가 있습니다: [SEARCH_TERM]",
                alt_search: "검색: [SEARCH_TERM]",
                search_suggestion: "검색어를 입력하세요",
                searching: "검색 중..."
            }
        });
        
        // PagefindUI의 기본 검색 입력 숨기기
        setTimeout(() => {
            const pagefindInput = document.querySelector('.pagefind-ui__search-input');
            if (pagefindInput) {
                pagefindInput.style.display = 'none';
            }
            
            // 즉시 이미지 컨테이너 생성 함수 정의
            window.createImmediateImageContainers = createImmediateImageContainers;
            
            // 검색 결과가 렌더링된 후 이미지 추가
            addImagesToResults();
        }, 100);
        
        // debounce 제거됨 - 즉시 컨테이너 생성 방식으로 인해 불필요
        
        // 통합된 MutationObserver - 모든 DOM 변경을 한 번에 처리
        const unifiedObserver = new MutationObserver(function(mutations) {
            let needImageUpdate = false;
            
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                    for (let node of mutation.addedNodes) {
                        if (node.nodeType === Node.ELEMENT_NODE) {
                            // 검색 결과 추가 감지
                            if (node.classList.contains('pagefind-ui__result') || 
                                (node.querySelector && node.querySelector('.pagefind-ui__result'))) {
                                needImageUpdate = true;
                            }
                            
                            // 썸네일 제거
                            if (node.classList.contains('pagefind-ui__result-thumb')) {
                                node.remove();
                            }
                            
                            // 클리어 버튼 제거
                            if (node.classList.contains('pagefind-ui__search-clear')) {
                                node.remove();
                            }
                        }
                    }
                }
            });
            
            if (needImageUpdate) {
                console.log('🔄 새로운 검색 결과 감지, 즉시 이미지 컨테이너 생성');
                // 즉시 이미지 컨테이너 생성 (레이아웃 시프트 방지)
                setTimeout(() => {
                    createImmediateImageContainers();
                }, 10);
                
                // 실제 이미지 로딩 시도
                setTimeout(addImagesToResults, 300);
            }
        });
        
        // 검색 컨테이너와 body 모두 관찰
        const searchContainer = document.getElementById('search');
        if (searchContainer) {
            unifiedObserver.observe(searchContainer, { childList: true, subtree: true });
        }
        unifiedObserver.observe(document.body, { childList: true, subtree: true });
        
        /**
         * 모든 검색 결과에 즉시 이미지 컨테이너 생성 (레이아웃 시프트 방지)
         */
        function createImmediateImageContainers() {
            const results = document.querySelectorAll('.pagefind-ui__result:not(.image-processed)');
            
            results.forEach((result) => {
                const link = result.querySelector('.pagefind-ui__result-link');
                if (!link) return;
                
                // 이미 이미지 컨테이너가 있는지 확인
                if (result.querySelector('.search-result-image')) return;
                
                // 즉시 skeleton 이미지 컨테이너 생성
                const imageContainer = document.createElement('div');
                imageContainer.className = 'search-result-image';
                
                // 모바일 환경 감지
                const isMobile = window.innerWidth <= 768;
                
                imageContainer.style.cssText = `
                    width: ${isMobile ? '100%' : '120px'};
                    height: ${isMobile ? '200px' : '120px'};
                    flex-shrink: 0;
                    position: relative;
                    background: linear-gradient(90deg, #f0f0f0 25%, transparent 37%, #f0f0f0 63%);
                    background-size: 400% 100%;
                    animation: skeleton-loading 1.5s ease-in-out infinite;
                    border-radius: 8px;
                    overflow: hidden;
                    border: 1px solid #e0e0e0;
                    background-color: #f8f9fa;
                    margin-top: 1.5rem;
                    margin-left: ${isMobile ? '0' : '2.5rem'};
                    margin-right: 0;
                    margin-bottom: ${isMobile ? '1rem' : '0'};
                `;
                
                // 검색 결과 구조 변경 - 이미지를 맨 앞에 배치
                result.insertBefore(imageContainer, result.firstChild);
                result.classList.add('image-processed');
                
                console.log('📦 즉시 이미지 컨테이너 생성:', link.href);
            });
            
            // 즉시 이미지 컨테이너 생성 후 실제 이미지 로딩 시작
            console.log('🚀 즉시 이미지 로딩 시작');
            setTimeout(() => {
                addImagesToResults();
            }, 50);
        }
        
        // URL 파라미터에서 검색어 추출
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('keyword') || urlParams.get('q') || urlParams.get('search');
        
        if (searchQuery) {
            document.getElementById('pagefind-search-input').value = searchQuery;
            // 잠시 후 검색 실행 (PagefindUI가 완전히 로드된 후)
            setTimeout(() => {
                SearchUtils.triggerSearch();
            }, 500);
        }
        
        // 커스텀 검색 입력과 PagefindUI 연결
        const customInput = document.getElementById('pagefind-search-input');
        customInput.addEventListener('input', function() {
            const pagefindInput = document.querySelector('.pagefind-ui__search-input');
            if (pagefindInput) {
                pagefindInput.value = this.value;
                pagefindInput.dispatchEvent(new Event('input'));
            }
            SearchUtils.updateSearchResultTitle(this.value);
        });
        
        // 엔터 키 검색 지원
        customInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                SearchUtils.triggerSearch();
            }
        });
    });

function addImagesToResults() {
        const results = document.querySelectorAll('.pagefind-ui__result');
        results.forEach(result => {
            console.log('🔍 검색 결과 처리 중:', result);
            
            // 기존 이미지 컨테이너가 있으면 그것을 사용
            let existingContainer = result.querySelector('.search-result-image');
            if (existingContainer && existingContainer.querySelector('img')) {
                console.log('⏭️ 이미 이미지가 있는 결과 건너뛰기');
                return;
            }
            
            result.classList.add('image-processed');

            // 검색 결과에서 이미지 메타데이터 찾기
            const link = result.querySelector('.pagefind-ui__result-link');
            if (!link) return;

            const url = link.href;
            
            // 간소화된 이미지 URL 조회
            const pageUrl = link.href;
            const pagefindMetaImage = imageUrlStore.get(pageUrl);
            
            if (pagefindMetaImage) {
                console.log('✅ 저장된 이미지 URL 사용:', pagefindMetaImage);
                createImageElement(result, link, pagefindMetaImage);
                ImageCacheManager.set(url, pagefindMetaImage);
                return;
            }

            // 2. 이미지 캐시 확인 후 실제 페이지에서 헤더 이미지 추출 시도
            const cachedImageUrl = ImageCacheManager.get(url);
            if (cachedImageUrl) {
                console.log('💾 캐시된 이미지 사용:', url, '→', cachedImageUrl);
                if (cachedImageUrl !== 'NO_IMAGE') {
                    createImageElement(result, link, cachedImageUrl);
                }
                // NO_IMAGE인 경우 skeleton 컨테이너가 이미 생성되어 있으므로 추가 작업 불필요
            } else {
                console.log('🔍 새로운 이미지 검색 시작:', url);
                fetchHeaderImage(url).then(headerImageUrl => {
                    // result가 여전히 DOM에 존재하는지 확인 (비동기 fetch 중 DOM 변경 방지)
                    if (!document.body.contains(result)) return;
                    
                    // 이미지 URL을 캐시에 저장 (null인 경우 'NO_IMAGE'로 저장하여 재시도 방지)
                    ImageCacheManager.set(url, headerImageUrl || 'NO_IMAGE');
                    
                    if (headerImageUrl) {
                        console.log('✅ 이미지 발견 및 생성:', headerImageUrl);
                        createImageElement(result, link, headerImageUrl);
                    }
                    // 이미지가 없는 경우 skeleton 컨테이너가 이미 생성되어 있으므로 추가 작업 불필요
                }).catch((error) => {
                    console.log('❌ 이미지 검색 실패:', error);
                    ImageCacheManager.set(url, 'NO_IMAGE'); // 실패도 캐시하여 재시도 방지
                    // 실패한 경우에도 skeleton 컨테이너가 이미 생성되어 있으므로 추가 작업 불필요
                });
            }
        });
    }
// ========================================
// 이미지 후보 생성 시스템
// ========================================

/**
 * 이미지 후보 생성기 - 다양한 이미지 소스를 시도
 */
const ImageCandidateGenerator = {
    /**
     * 우선순위 이미지 파일명들 (실제 컨텐츠 이미지)
     */
    priorityFiles: [
        'poster.webp',        // TV Show 등에서 주로 사용
        'poster.jpg',
        'poster.png'
    ],

    // 카테고리별 fallback 제거됨 - 기본 아바타로 통합

    /**
     * 페이지 URL에서 이미지 후보들을 생성
     * @param {string} pageUrl - 페이지 URL
     * @returns {string[]} - 이미지 후보 URL 배열 (우선순위 순)
     */
    generate(pageUrl) {
        const url = new URL(pageUrl, window.location.origin);
        const basePath = url.pathname.endsWith('/') ? url.pathname.slice(0, -1) : url.pathname;
        const candidates = [];

        // 1. 우선순위 이미지들 (실제 컨텐츠)
        this.priorityFiles.forEach(filename => {
            candidates.push(`${basePath}/${filename}`);
        });

        // 아바타 fallback 제거 - 실제 이미지만 사용

        return candidates;
    }
};


    

// ========================================
// 로깅 시스템
// ========================================

// Logger 객체 제거됨 - 직접 console.log 사용으로 간소화

/**
 * 개선된 헤더 이미지 검색 - HTML 파싱으로 실제 이미지 찾기
 * @param {string} pageUrl - 페이지 URL
 * @returns {Promise<string|null>} - 이미지 URL 또는 null
 */
async function fetchHeaderImage(pageUrl) {
        try {
            console.log('🔍 개선된 이미지 검색:', pageUrl);
            
            // 1. 먼저 기본 후보 시도
            const imageCandidates = ImageCandidateGenerator.generate(pageUrl);
            for (const imageUrl of imageCandidates) {
                if (ImageCacheManager.isFailed(imageUrl)) continue;
                
                try {
                    const response = await fetch(imageUrl, { method: 'HEAD' });
                    if (response.ok) {
                        console.log('✅ 기본 후보에서 이미지 발견:', imageUrl);
                        return imageUrl;
                    }
                    ImageCacheManager.addFailed(imageUrl);
                } catch (e) {
                    ImageCacheManager.addFailed(imageUrl);
                }
            }
            
            // 2. HTML 파싱으로 실제 이미지 찾기
            console.log('🔍 HTML 파싱으로 이미지 검색 시도:', pageUrl);
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 3000);
            
            const response = await fetch(pageUrl, { 
                signal: controller.signal,
                cache: 'force-cache'
            });
            clearTimeout(timeoutId);
            
            if (!response.ok) {
                console.log('❌ 페이지 가져오기 실패:', response.status, pageUrl);
                return null;
            }
            
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 3. article 내 이미지 찾기
            const articleImages = doc.querySelectorAll('article img, .article-content img, .content img, main img');
            console.log('📰 Article 이미지 개수:', articleImages.length);
            
            for (const articleImg of articleImages) {
                let src = articleImg.src || articleImg.getAttribute('src') || articleImg.getAttribute('data-src');
                if (!src) continue;
                
                // 아바타, favicon 제외
                if (src.includes('avatar') || src.includes('favicon') || src.endsWith('.ico')) {
                    continue;
                }
                
                // 포트 수정
                if (src.includes('localhost:12345')) {
                    src = src.replace('localhost:12345', window.location.host);
                }
                
                // 상대 경로 처리
                if (src.startsWith('/')) {
                    src = window.location.origin + src;
                }
                
                console.log('✅ Article 이미지 발견:', src);
                return src;
            }
            
            console.log('❌ 이미지를 찾을 수 없음:', pageUrl);
            return null;
        } catch (error) {
            if (error.name !== 'AbortError') {
                console.warn('이미지 검색 실패:', pageUrl, error.message);
            }
            return null;
        }
    }

// 검색 관련 유틸리티 함수들
const SearchUtils = {
    triggerSearch() {
        const searchTerm = document.getElementById('pagefind-search-input').value;
        const pagefindInput = document.querySelector('.pagefind-ui__search-input');
        if (pagefindInput) {
            pagefindInput.value = searchTerm;
            pagefindInput.dispatchEvent(new Event('input'));
        }
        this.updateSearchResultTitle(searchTerm);
    },

    updateSearchResultTitle(searchTerm) {
        const resultTitle = document.querySelector('.search-result--title');
        if (searchTerm.trim()) {
            resultTitle.textContent = `"${searchTerm}"에 대한 검색 결과`;
            resultTitle.style.display = 'block';
        } else {
            resultTitle.style.display = 'none';
        }
    }
};

// 전역 접근을 위한 별칭 (HTML에서 onclick 사용)
window.triggerSearch = () => SearchUtils.triggerSearch();

    // 통합된 MutationObserver에서 처리됨 - 별도 함수들 제거
</script>

<style>
    /* PagefindUI 기본 검색 입력 숨기기 */
    .pagefind-ui__search-input {
        display: none !important;
    }
    
    /* PagefindUI 결과를 article-list--compact 스타일로 변환 */
    .pagefind-ui__results {
        margin-top: 0;
    }
    
    .pagefind-ui__result {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        padding: 0;
        border: none;
        border-radius: 0;
        background: transparent;
        transition: none;
        transform: none;
        box-shadow: none;
        border-bottom: 1px solid var(--card-separator-color, #ddd);
        padding-bottom: 1.5rem;
        --pagefind-ui-border-width: 0 !important;
    }
    
    .pagefind-ui__result:hover {
        box-shadow: none;
        transform: none;
    }
    
    .pagefind-ui__result:last-child {
        border-bottom: none;
    }
    
    /* 검색 결과 이미지 스타일 */
    .search-result-image {
        flex-shrink: 0;
        width: 120px;
        height: 120px;
        margin-top: 1.5rem;
        margin-left: 2.5rem;
        margin-right: 0;
        border-radius: 8px;
        overflow: hidden;
        background: var(--card-background, #ffffff);
        border: 1px solid var(--card-separator-color, #ddd);
        display: flex;
        align-items: center;
        justify-content: center;
        /* 레이아웃 시프트 방지를 위한 고정 크기 */
        min-width: 120px;
        min-height: 120px;
        max-width: 120px;
        max-height: 120px;
    }
    
    .search-result-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        /* GPU 가속을 위한 transform 추가 */
        transform: translateZ(0);
        /* 이미지 로딩 중 깜빡임 방지 */
        transition: opacity 0.2s ease;
    }
    
    .search-result-image img[src=""] {
        opacity: 0;
    }
    
    /* 검색 결과 내용 영역 */
    .search-result-content {
        flex: 1;
        min-width: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .pagefind-ui__result-link {
        color: var(--card-text-color-main, var(--body-text-color, #1a1a1a));
        text-decoration: none;
        font-weight: 700;
        font-size: 1.8rem;
        line-height: 1.3;
        display: block;
        margin-bottom: 0.8rem;
        transition: color 0.2s ease;
    }
    
    .pagefind-ui__result-link:hover {
        color: var(--accent-color, #007acc);
        text-decoration: underline;
    }
    
    /* 다크 모드 지원 */
    @media (prefers-color-scheme: dark) {
        .pagefind-ui__result-link {
            color: var(--card-text-color-main, var(--body-text-color, #ffffff));
        }
        
        .pagefind-ui__result-link:hover {
            color: var(--accent-color, #4a9eff);
        }
        
        .search-result-image {
            background: var(--card-background, #2a2a2a);
            border-color: var(--card-separator-color, #444);
        }
    }
    
    /* 사이트 테마의 다크 모드 클래스 지원 */
    [data-scheme="dark"] .pagefind-ui__result-link,
    .dark .pagefind-ui__result-link,
    body.dark .pagefind-ui__result-link {
        color: var(--card-text-color-main, var(--body-text-color, #ffffff)) !important;
    }
    
    [data-scheme="dark"] .pagefind-ui__result-link:hover,
    .dark .pagefind-ui__result-link:hover,
    body.dark .pagefind-ui__result-link:hover {
        color: var(--accent-color, #4a9eff) !important;
    }
    
    [data-scheme="dark"] .search-result-image,
    .dark .search-result-image,
    body.dark .search-result-image {
        background: var(--card-background, #2a2a2a) !important;
        border-color: var(--card-separator-color, #444) !important;
    }
    
    /* 이미지 로드 실패 시 표시되는 텍스트 스타일 */
    .search-result-image div {
        text-align: center;
        font-size: 12px;
        color: var(--card-text-color-secondary, #6c757d);
        user-select: none;
    }
    
    [data-scheme="dark"] .search-result-image div,
    .dark .search-result-image div,
    body.dark .search-result-image div {
        color: var(--card-text-color-secondary, #a0a0a0) !important;
    }
    
    .pagefind-ui__result-excerpt {
        color: var(--card-text-color-secondary, var(--body-text-color-secondary, #6b6b6b));
        line-height: 1.6;
        margin-bottom: 0.8rem;
        font-size: 0.95rem;
    }
    
    .pagefind-ui__result-excerpt mark {
        background-color: var(--accent-color-lighter, rgba(0, 122, 204, 0.1));
        color: var(--accent-color-darker, var(--accent-color, #007acc));
        padding: 0.1em 0.3em;
        border-radius: 3px;
        font-weight: 600;
    }
    
    /* 다크 모드에서 하이라이트 색상 */
    @media (prefers-color-scheme: dark) {
        .pagefind-ui__result-excerpt {
            color: var(--card-text-color-secondary, var(--body-text-color-secondary, #999999));
        }
        
        .pagefind-ui__result-excerpt mark {
            background-color: var(--accent-color-lighter, rgba(74, 158, 255, 0.2));
            color: var(--accent-color, #4a9eff);
        }
    }
    
    [data-scheme="dark"] .pagefind-ui__result-excerpt,
    .dark .pagefind-ui__result-excerpt,
    body.dark .pagefind-ui__result-excerpt {
        color: var(--card-text-color-secondary, var(--body-text-color-secondary, #999999)) !important;
    }
    
    [data-scheme="dark"] .pagefind-ui__result-excerpt mark,
    .dark .pagefind-ui__result-excerpt mark,
    body.dark .pagefind-ui__result-excerpt mark {
        background-color: var(--accent-color-lighter, rgba(74, 158, 255, 0.2)) !important;
        color: var(--accent-color, #4a9eff) !important;
    }
    
    .pagefind-ui__result-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.8rem;
    }
    
    .pagefind-ui__result-tag {
        background: var(--tag-background-color, rgba(0, 122, 204, 0.1));
        color: var(--tag-text-color, var(--accent-color, #007acc));
        padding: 0.3em 0.8em;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .pagefind-ui__result-tag:hover {
        background: var(--tag-background-color-hover, var(--accent-color, #007acc));
        color: var(--tag-text-color-hover, #ffffff);
    }
    
    .pagefind-ui__button {
        background: var(--accent-color, #007acc);
        color: white;
        border: none;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1.5rem;
    }
    
    .pagefind-ui__button:hover {
        background: var(--accent-color-darker, #005a99);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 122, 204, 0.3);
    }
    
    .pagefind-ui__message {
        text-align: center;
        color: var(--card-text-color-secondary, var(--body-text-color-secondary, #6b6b6b));
        font-style: italic;
        margin: 2rem 0;
        font-size: 1.1rem;
    }
    
    /* 검색 결과 제목 스타일 */
    .search-result--title {
        display: none;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--card-text-color-main, var(--body-text-color, #1a1a1a));
        margin-bottom: 1.5rem;
    }
    
    .search-result--title.show {
        display: block;
    }
    
    /* 다크 모드에서 검색 결과 제목 */
    @media (prefers-color-scheme: dark) {
        .search-result--title {
            color: var(--card-text-color-main, var(--body-text-color, #ffffff));
        }
    }
    
    [data-scheme="dark"] .search-result--title,
    .dark .search-result--title,
    body.dark .search-result--title {
        color: var(--card-text-color-main, var(--body-text-color, #ffffff)) !important;
    }
    
    /* 모바일 반응형 */
    @media (max-width: 768px) {
        .pagefind-ui__result {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-result-image {
            width: 100%;
            height: 200px;
            margin-left: 0;
            margin-bottom: 1rem;
            /* 모바일에서도 레이아웃 시프트 방지 */
            min-width: 100%;
            min-height: 200px;
            max-width: 100%;
            max-height: 200px;
        }
        
        .search-result-content {
            align-items: flex-start;
        }
        
        .pagefind-ui__result-link {
            font-size: 1.5rem;
        }
    }

    .search-result-image--placeholder {
        background: transparent !important;
        border: none !important;
    }

    .pagefind-ui__form.svelte-e9gkc3:before {
        display: none !important;
        content: none !important;
    }

    .pagefind-ui__message.svelte-e9gkc3 {
        margin-left: 2rem;
        font-size: 1.3rem;
    }
</style>

{{ partialCached "footer/footer" . }}
{{ end }}

