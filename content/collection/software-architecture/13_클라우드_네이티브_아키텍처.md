---
draft: true
---
# 13ì¥. í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì•„í‚¤í…ì²˜

## ğŸ“‹ í•™ìŠµ ëª©í‘œ
- 12 Factor App ì›ì¹™ì„ ì´í•´í•˜ê³  ì ìš©í•œë‹¤
- ì»¨í…Œì´ë„ˆ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ìŠµë“í•œë‹¤
- ì„œë¹„ìŠ¤ ë©”ì‹œ ì•„í‚¤í…ì²˜ì˜ ê°œë…ì„ íŒŒì•…í•œë‹¤
- í´ë¼ìš°ë“œ ë³´ì•ˆ ì•„í‚¤í…ì²˜ë¥¼ í•™ìŠµí•œë‹¤

---

## 13.1 12 Factor App ì›ì¹™

### 13.1.1 12 Factor Appì´ë€?

12 Factor Appì€ **í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì„ ìœ„í•œ ë°©ë²•ë¡ **ìœ¼ë¡œ, í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ SaaS ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶• ì›ì¹™ì…ë‹ˆë‹¤.

### 13.1.2 í•µì‹¬ ì›ì¹™ êµ¬í˜„ ì˜ˆì œ

```java
// 1. ì½”ë“œë² ì´ìŠ¤ (Codebase) - í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤, ì—¬ëŸ¬ ë°°í¬
// Git ì €ì¥ì†Œ í•˜ë‚˜ì—ì„œ dev, staging, production í™˜ê²½ìœ¼ë¡œ ë°°í¬

// 2. ì¢…ì†ì„± (Dependencies) - ëª…ì‹œì  ì„ ì–¸ê³¼ ê²©ë¦¬
// Maven/Gradleì„ í†µí•œ ëª…ì‹œì  ì˜ì¡´ì„± ê´€ë¦¬
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web:2.7.0'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa:2.7.0'
}

// 3. ì„¤ì • (Config) - í™˜ê²½ì— ì„¤ì • ì €ì¥
@Configuration
public class DatabaseConfig {
    
    @Value("${DATABASE_URL}")
    private String databaseUrl;
    
    @Value("${DATABASE_USERNAME}")
    private String username;
    
    @Value("${DATABASE_PASSWORD}")
    private String password;
    
    @Bean
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl(databaseUrl);
        config.setUsername(username);
        config.setPassword(password);
        return new HikariDataSource(config);
    }
}

// 4. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Backing Services) - ì—°ê²°ëœ ìì›ìœ¼ë¡œ ì·¨ê¸‰
@Service
public class OrderService {
    
    // ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ê²°ëœ ìì›ìœ¼ë¡œ ì·¨ê¸‰
    private final OrderRepository orderRepository;
    
    // ì™¸ë¶€ APIë¥¼ ì—°ê²°ëœ ìì›ìœ¼ë¡œ ì·¨ê¸‰
    private final PaymentGatewayClient paymentGateway;
    
    // ë©”ì‹œì§€ íë¥¼ ì—°ê²°ëœ ìì›ìœ¼ë¡œ ì·¨ê¸‰  
    private final MessageQueue messageQueue;
    
    public OrderService(OrderRepository orderRepository,
                       PaymentGatewayClient paymentGateway,
                       MessageQueue messageQueue) {
        this.orderRepository = orderRepository;
        this.paymentGateway = paymentGateway;
        this.messageQueue = messageQueue;
    }
}

// 5. ë¹Œë“œ, ë¦´ë¦¬ìŠ¤, ì‹¤í–‰ (Build, Release, Run) - ë‹¨ê³„ ì—„ê²©íˆ ë¶„ë¦¬
// Dockerfile
FROM openjdk:11-jre-slim
COPY target/app.jar app.jar
ENTRYPOINT ["java", "-jar", "/app.jar"]

# Jenkins Pipeline
pipeline {
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Release') {
            steps {
                sh 'docker build -t myapp:${BUILD_NUMBER} .'
                sh 'docker push myapp:${BUILD_NUMBER}'
            }
        }
        stage('Run') {
            steps {
                sh 'kubectl set image deployment/myapp myapp=myapp:${BUILD_NUMBER}'
            }
        }
    }
}

// 6. í”„ë¡œì„¸ìŠ¤ (Processes) - ë¬´ìƒíƒœ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
@RestController
public class OrderController {
    
    private final OrderService orderService;
    
    // ìƒíƒœë¥¼ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥í•˜ì§€ ì•ŠìŒ
    @PostMapping("/orders")
    public ResponseEntity<Order> createOrder(@RequestBody CreateOrderRequest request) {
        // ëª¨ë“  ìƒíƒœëŠ” ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ì™¸ë¶€ ìŠ¤í† ì–´ì— ì €ì¥
        Order order = orderService.createOrder(request);
        return ResponseEntity.ok(order);
    }
}

// 7. í¬íŠ¸ ë°”ì¸ë”© (Port Binding) - í¬íŠ¸ ë°”ì¸ë”©ìœ¼ë¡œ ì„œë¹„ìŠ¤ ê³µê°œ
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}

// application.yml
server:
  port: ${PORT:8080}

// 8. ë™ì‹œì„± (Concurrency) - í”„ë¡œì„¸ìŠ¤ ëª¨ë¸ë¡œ í™•ì¥
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("async-");
        executor.initialize();
        return executor;
    }
}

// 9. íê¸° ê°€ëŠ¥ (Disposability) - ë¹ ë¥¸ ì‹œì‘ê³¼ ìš°ì•„í•œ ì¢…ë£Œ
@Component
public class GracefulShutdown implements ApplicationListener<ContextClosedEvent> {
    
    @Override
    public void onApplicationEvent(ContextClosedEvent event) {
        // ì§„í–‰ ì¤‘ì¸ ìš”ì²­ ì™„ë£Œ ëŒ€ê¸°
        log.info("ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë©ë‹ˆë‹¤. ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì„ ì™„ë£Œí•˜ëŠ” ì¤‘...");
        
        // ë¦¬ì†ŒìŠ¤ ì •ë¦¬
        cleanupResources();
    }
    
    private void cleanupResources() {
        // ì»¤ë„¥ì…˜ í’€ ì¢…ë£Œ, íŒŒì¼ í•¸ë“¤ í•´ì œ ë“±
    }
}

// 10. ê°œë°œ/í”„ë¡œë•ì…˜ ë™ë“±ì„± (Dev/Prod Parity) - ê°œë°œ, ìŠ¤í…Œì´ì§•, í”„ë¡œë•ì…˜ í™˜ê²½ì„ ìµœëŒ€í•œ ë¹„ìŠ·í•˜ê²Œ
// Docker Composeë¡œ ë¡œì»¬ í™˜ê²½ êµ¬ì„±
version: '3.8'
services:
  app:
    build: .
    environment:
      - DATABASE_URL=jdbc:postgresql://db:5432/myapp
    depends_on:
      - db
  db:
    image: postgres:13
    environment:
      - POSTGRES_DB=myapp

// 11. ë¡œê·¸ (Logs) - ë¡œê·¸ë¥¼ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì·¨ê¸‰
@Component
public class StructuredLogging {
    
    private final Logger logger = LoggerFactory.getLogger(StructuredLogging.class);
    private final ObjectMapper objectMapper = new ObjectMapper();
    
    public void logOrderCreated(String orderId, String customerId) {
        try {
            Map<String, Object> logEvent = Map.of(
                "event", "order_created",
                "order_id", orderId,
                "customer_id", customerId,
                "timestamp", Instant.now().toString()
            );
            
            // êµ¬ì¡°í™”ëœ ë¡œê·¸ë¥¼ stdoutìœ¼ë¡œ ì¶œë ¥
            logger.info(objectMapper.writeValueAsString(logEvent));
        } catch (Exception e) {
            logger.error("ë¡œê·¸ ì‘ì„± ì‹¤íŒ¨", e);
        }
    }
}

// 12. ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤ (Admin Processes) - ì¼íšŒì„± ê´€ë¦¬ ì‘ì—…ì„ ì¼íšŒì„± í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
@Component
public class DataMigrationCommand implements CommandLineRunner {
    
    private final DataMigrationService migrationService;
    
    @Override
    public void run(String... args) throws Exception {
        if (args.length > 0 && "migrate".equals(args[0])) {
            migrationService.migrate();
        }
    }
}
```

---

## 13.2 ì»¨í…Œì´ë„ˆ ì•„í‚¤í…ì²˜ íŒ¨í„´

### 13.2.1 ì»¨í…Œì´ë„ˆ ì„¤ê³„ íŒ¨í„´

```java
// ì‚¬ì´ë“œì¹´ íŒ¨í„´ (Sidecar Pattern)
// ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í•¨ê»˜ ë°°í¬ë˜ëŠ” ë³´ì¡° ì»¨í…Œì´ë„ˆ

// ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
@RestController
public class UserController {
    
    @GetMapping("/users/{id}")
    public ResponseEntity<User> getUser(@PathVariable String id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
}

// Kubernetes Deployment with Sidecar
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  template:
    spec:
      containers:
      - name: user-service
        image: user-service:latest
        ports:
        - containerPort: 8080
      - name: logging-sidecar
        image: fluentd:latest
        volumeMounts:
        - name: log-volume
          mountPath: /var/log
      volumes:
      - name: log-volume
        emptyDir: {}

// ì•°ë°°ì„œë” íŒ¨í„´ (Ambassador Pattern)
@Component
public class DatabaseAmbassador {
    
    private final List<DataSource> dataSources;
    private final LoadBalancer loadBalancer;
    
    public Connection getConnection() {
        DataSource selectedDataSource = loadBalancer.select(dataSources);
        return selectedDataSource.getConnection();
    }
}

// ì–´ëŒ‘í„° íŒ¨í„´ (Adapter Pattern)
@Component
public class LegacySystemAdapter {
    
    private final LegacyClient legacyClient;
    
    public ModernResponse adaptLegacyCall(ModernRequest request) {
        LegacyRequest legacyRequest = convertToLegacyFormat(request);
        LegacyResponse legacyResponse = legacyClient.call(legacyRequest);
        return convertToModernFormat(legacyResponse);
    }
}
```

### 13.2.2 ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ

```dockerfile
# ë©€í‹° ìŠ¤í…Œì´ì§€ Dockerfile
# Stage 1: Build
FROM maven:3.8-openjdk-11 AS builder
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

# Stage 2: Runtime
FROM openjdk:11-jre-slim
WORKDIR /app
COPY --from=builder /app/target/app.jar app.jar

# ë³´ì•ˆì„ ìœ„í•œ non-root ì‚¬ìš©ì ìƒì„±
RUN addgroup --system appgroup && adduser --system appuser --ingroup appgroup
USER appuser

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

---

## 13.3 ì„œë¹„ìŠ¤ ë©”ì‹œ ì•„í‚¤í…ì²˜

### 13.3.1 ì„œë¹„ìŠ¤ ë©”ì‹œë€?

ì„œë¹„ìŠ¤ ë©”ì‹œëŠ” **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ì˜ í†µì‹ ì„ ì²˜ë¦¬í•˜ëŠ” ì¸í”„ë¼ ê³„ì¸µ**ìœ¼ë¡œ, íŠ¸ë˜í”½ ê´€ë¦¬, ë³´ì•ˆ, ê´€ì°° ê°€ëŠ¥ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.

### 13.3.2 Istio ì„œë¹„ìŠ¤ ë©”ì‹œ êµ¬í˜„

```yaml
# Virtual Service - íŠ¸ë˜í”½ ë¼ìš°íŒ…
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: user-service
spec:
  hosts:
  - user-service
  http:
  - match:
    - headers:
        version:
          exact: v2
    route:
    - destination:
        host: user-service
        subset: v2
  - route:
    - destination:
        host: user-service
        subset: v1

# Destination Rule - ë¡œë“œ ë°¸ëŸ°ì‹±
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-service
spec:
  host: user-service
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2

# Service Entry - ì™¸ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼
apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: external-payment-service
spec:
  hosts:
  - payment-api.example.com
  ports:
  - number: 443
    name: https
    protocol: HTTPS
  location: MESH_EXTERNAL
  resolution: DNS
```

### 13.3.3 Circuit Breaker with Istio

```java
// ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
@Service
public class PaymentService {
    
    private final PaymentClient paymentClient;
    
    public PaymentResult processPayment(PaymentRequest request) {
        try {
            return paymentClient.processPayment(request);
        } catch (Exception e) {
            // Istioê°€ Circuit Breakerë¥¼ ì²˜ë¦¬í•˜ë¯€ë¡œ 
            // ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œëŠ” ë‹¨ìˆœí•˜ê²Œ ìœ ì§€
            throw new PaymentProcessingException("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨", e);
        }
    }
}
```

```yaml
# Istio Destination Rule with Circuit Breaker
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: payment-service
spec:
  host: payment-service
  trafficPolicy:
    outlierDetection:
      consecutiveErrors: 3
      interval: 30s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
    connectionPool:
      tcp:
        maxConnections: 10
      http:
        http1MaxPendingRequests: 10
        maxRequestsPerConnection: 2
```

---

## 13.4 í´ë¼ìš°ë“œ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 13.4.1 Zero Trust ì•„í‚¤í…ì²˜

```java
// JWT ê¸°ë°˜ ì¸ì¦
@RestController
public class SecureController {
    
    @PreAuthorize("hasRole('USER')")
    @GetMapping("/secure/data")
    public ResponseEntity<SecureData> getSecureData(
            @AuthenticationPrincipal JwtAuthenticationToken token) {
        
        String userId = token.getToken().getClaimAsString("sub");
        
        // ì„¸ë°€í•œ ê¶Œí•œ ê²€ì‚¬
        if (!hasAccessToResource(userId, "secure-data")) {
            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();
        }
        
        SecureData data = secureDataService.getData(userId);
        return ResponseEntity.ok(data);
    }
    
    private boolean hasAccessToResource(String userId, String resource) {
        // ì‹¤ì‹œê°„ ê¶Œí•œ ê²€ì¦
        return authorizationService.checkAccess(userId, resource);
    }
}

// Security Configuration
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .oauth2ResourceServer(oauth2 -> oauth2
                .jwt(jwt -> jwt.jwtDecoder(jwtDecoder()))
            )
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

### 13.4.2 Secrets ê´€ë¦¬

```java
// Kubernetes Secrets ì‚¬ìš©
@Configuration
public class SecretsConfig {
    
    @Value("${spring.datasource.password}")
    private String databasePassword;
    
    @Bean
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:postgresql://db:5432/myapp");
        config.setUsername("app_user");
        config.setPassword(databasePassword); // Kubernetes Secretì—ì„œ ì£¼ì…
        return new HikariDataSource(config);
    }
}
```

```yaml
# Kubernetes Secret
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
type: Opaque
data:
  password: <base64-encoded-password>

# Deployment with Secret
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        env:
        - name: SPRING_DATASOURCE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: password
```

### 13.4.3 ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

```yaml
# Network Policy - ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ ë³´ì•ˆ
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: web-netpol
spec:
  podSelector:
    matchLabels:
      app: web
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: database
    ports:
    - protocol: TCP
      port: 5432
```

---

## ğŸ¯ í•µì‹¬ ìš”ì•½

### í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì•„í‚¤í…ì²˜ êµ¬ì„± ìš”ì†Œ

| **êµ¬ì„± ìš”ì†Œ** | **ëª©ì ** | **ì£¼ìš” ê¸°ìˆ ** | **ê³ ë ¤ì‚¬í•­** |
|-------------|---------|-------------|------------|
| **12 Factor App** | í´ë¼ìš°ë“œ ì í•©ì„± | í™˜ê²½ ë³€ìˆ˜, ë¬´ìƒíƒœ | ì›ì¹™ ì¤€ìˆ˜ |
| **ì»¨í…Œì´ë„ˆ** | ì¼ê´€ëœ ì‹¤í–‰ í™˜ê²½ | Docker, Kubernetes | ë³´ì•ˆ, ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ |
| **ì„œë¹„ìŠ¤ ë©”ì‹œ** | ì„œë¹„ìŠ¤ ê°„ í†µì‹  | Istio, Linkerd | ë³µì¡ì„± ê´€ë¦¬ |
| **Zero Trust** | ë³´ì•ˆ ëª¨ë¸ | JWT, mTLS | ì„±ëŠ¥ ì˜í–¥ |

### êµ¬í˜„ ê°€ì´ë“œë¼ì¸
1. **12 Factor App ì›ì¹™ ì¤€ìˆ˜**
2. **ì»¨í…Œì´ë„ˆ ìµœì í™” ë° ë³´ì•ˆ**
3. **ì„œë¹„ìŠ¤ ë©”ì‹œë¥¼ í†µí•œ íŠ¸ë˜í”½ ê´€ë¦¬**
4. **Zero Trust ë³´ì•ˆ ëª¨ë¸ ì ìš©**

---

## ğŸ’­ ìƒê°í•´ë³´ê¸°

1. ê¸°ì¡´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ 12 Factor Appìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ì „ëµì€?
2. ì„œë¹„ìŠ¤ ë©”ì‹œ ë„ì… ì‹œ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬í•  ê²ƒì¸ê°€?
3. í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ í™˜ê²½ì—ì„œì˜ ë°ì´í„° ë³´ì•ˆ ì „ëµì€?

---

## ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ

### ë„ì„œ
- "Cloud Native Patterns" - Cornelia Davis
- "Kubernetes in Action" - Marko LukÅ¡a

### ì˜¨ë¼ì¸ ìë£Œ
- 12factor.net ê³µì‹ ì‚¬ì´íŠ¸
- Istio ê³µì‹ ë¬¸ì„œ
- CNCF Landscape 